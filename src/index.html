<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
  <script type="module" src="dist/main.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Melsec Mock Server GUI</title>
      <style>
      /* Monitor grid styles */
      .monitor-table { border-collapse: collapse; font-family: monospace; table-layout: fixed; width: 100%; }
      .monitor-table th, .monitor-table td { border: 1px solid #ddd; padding: 4px; text-align: center; vertical-align: middle; }
      /* device column wider to fit ~10 characters */
      .device-label { padding: 4px 8px; text-align: left; width:10ch; min-width:10ch; }
      /* bit cells are td elements; give them fixed small width (approx 1 character) */
  .bit-cell { width:1.2ch; min-width:14px; height:18px; border-radius:3px; border:1px solid #bbb; padding:0; margin:0; }
  .bit-header { width:1.2ch; min-width:14px; padding:4px; }
      .bit-on { background:#4da6ff; }
      .bit-off { background:#ffffff; }
      /* formatted value column (user-selectable format) */
      .format-cell { padding-left:6px; width:6ch; min-width:6ch; text-align: right; font-variant-numeric: tabular-nums; }
      /* raw hex column (fixed 6-character width like 0xFFFF) */
      .raw-cell { padding-left:6px; width:6ch; min-width:6ch; text-align: center; font-variant-numeric: tabular-nums; }
      /* tighten header spacing */
      .monitor-table thead th { background:#f7f7f7; font-weight:600; }
      /* paired row placeholder style when combined U32/I32/f32 selected */
      .paired-empty { background:#efefef; color:#666; }
      /* toolbar button active state */
      #display-toolbar .fmt-btn { padding:4px 8px; border-radius:4px; border:1px solid #ccc; background:#fff; cursor:pointer; }
      #display-toolbar .fmt-btn.active { background:#4da6ff; color:#fff; border-color:#3a8ed6; }
  /* selected table row */
  tr.selected-row { outline: 2px solid #4da6ff; background: rgba(77,166,255,0.06); }
  /* edit modal write-type buttons */
  #edit-modal .write-type { padding:6px 8px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer; font-size:0.9rem; }
  #edit-modal .write-type.active { background:#4da6ff; color:#fff; border-color:#3a8ed6; }
  #edit-modal #edit-modal-box { display:flex; flex-direction:column; }
    </style>
  </head>

  <body>
    <main class="container">

      <section class="row">
        <div style="border: #ffffff;border-color: #3a8ed6;"> 
          <h4>Mock server Setting</h4>
          <label>ポート設定：</label>
          <!-- IP is fixed to 0.0.0.0 and not shown per UX request -->
          <label>TCP <input id="tcp-port" value="5000" type="number" style="width:3rem"/></label>
          <label>UDP <input id="udp-port" type="number" value="5001" style="width:3rem"/></label>
          <label style="margin-left:8px;">次回自動起動 <input id="auto-start-next" type="checkbox" style="vertical-align:middle;"/></label>
          <button id="mock-toggle" style="padding:6px 12px; border-radius:6px; background:#4da6ff; color:#fff; border:none; cursor:pointer; margin-left:8px;">Start Mock</button>
            <span id="server-status" style="margin-left:12px; font-weight:bold">停止中</span>
        </div>
        <div>
          <label>待受タイムアウト(ms) : <input id="tim-await" type="number" placeholder="5000" style="width:3rem"/></label>
          </div>
        <!-- Interval is fixed to 500ms internally and not shown -->

          <!-- Temporary Set Word UI for testing external-write path -->
          <!-- SetWord removed (temporary testing UI) -->
      </section>

      <!-- Read/Write UI removed per spec -->

      <section class="row">
        <h4>デバイスモニタ</h4>
        <label>モニタ先頭デバイス <input id="mon-target" value="D100" placeholder="デバイス名 例: D" style="width:10rem"/></label>
          <div id="monitor-output" style="background:#fff; padding:8px; border-radius:6px; margin-top:8px;">
          <!-- display format toolbar placed above the table -->
          <div id="display-toolbar" style="margin-bottom:8px; display:flex; gap:6px; align-items:center;">
            <span style="font-size:0.9rem;">表示形式:</span>
            <div style="display:flex; gap:4px;">
              <button class="fmt-btn" title="BIN: 16ビットを二進表現で表示" data-fmt="BIN">BIN</button>
              <button class="fmt-btn" title="U16: 符号なし16ビット整数" data-fmt="U16">U16</button>
              <button class="fmt-btn" title="I16: 符号付き16ビット整数" data-fmt="I16">I16</button>
              <button class="fmt-btn" title="HEX: 16進表示 (0xFFFF)" data-fmt="HEX">HEX</button>
              <button class="fmt-btn" title="ASCII: ASCII文字として表示" data-fmt="ASCII">ASCII</button>
              <button class="fmt-btn" title="U32: 符号なし32ビット整数" data-fmt="U32">U32</button>
              <button class="fmt-btn" title="I32: 符号付き32ビット整数" data-fmt="I32">I32</button>
              <button class="fmt-btn" title="f32: IEEE754単精度浮動小数点として表示" data-fmt="F32">f32</button>
            </div>
          </div>
          <div style="max-height:360px; overflow:auto; padding:4px; border:1px solid #eee; border-radius:6px; background:#fafafa;">
            <table id="monitor-table" class="monitor-table" tabindex="0">
              <thead>
                <tr>
                  <th>デバイス</th>
                  <!-- bits 15..0 header -->
                  <th class="bit-header">F</th><th class="bit-header">E</th><th class="bit-header">D</th><th class="bit-header">C</th><th class="bit-header">B</th><th class="bit-header">A</th><th class="bit-header">9</th><th class="bit-header">8</th>
                  <th class="bit-header">7</th><th class="bit-header">6</th><th class="bit-header">5</th><th class="bit-header">4</th><th class="bit-header">3</th><th class="bit-header">2</th><th class="bit-header">1</th><th class="bit-header">0</th>
                <th>表示</th>
                <th>RAW</th>
                </tr>
              </thead>
              <tbody id="monitor-tbody">
              </tbody>
            </table>
          </div>
        </div>

        <h3 style="margin-top:12px">Monitor Log</h3>
        <pre id="monitor-log" style="max-height:120px; overflow:auto; background:#111; color:#eee; padding:8px; border-radius:6px; margin-top:8px; font-family:monospace; font-size:13px;"></pre>
      </section>
    
      <!-- Edit popup (modaless) for double-click write -->
      <div id="edit-modal" style="display:none; position:fixed; right:12px; bottom:12px; background:transparent; align-items:flex-end; justify-content:flex-end; z-index:9999;">
        <div id="edit-modal-box" style="background:#fff; padding:12px; border-radius:8px; width:340px; box-shadow:0 6px 24px rgba(0,0,0,0.12); position:fixed; right:12px; bottom:12px;">
          <h4 id="edit-modal-title" style="margin:0 0 8px 0">Edit</h4>
          <div style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px;">
            <!-- order and labels match the base display toolbar -->
            <button class="write-type" data-typ="BIN">BIN</button>
            <button class="write-type" data-typ="U16">U16</button>
            <button class="write-type" data-typ="I16">I16</button>
            <button class="write-type" data-typ="HEX">HEX</button>
            <button class="write-type" data-typ="ASCII">ASCII</button>
            <button class="write-type" data-typ="U32">U32</button>
            <button class="write-type" data-typ="I32">I32</button>
            <button class="write-type" data-typ="F32">f32</button>
          </div>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:6px;">
            <label style="flex:1; margin:0">値 <input id="edit-value" style="width:30%; box-sizing:border-box;" autocomplete="off"/><button id="edit-write" style="white-space:nowrap;">書込</button></label>
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button id="edit-cancel" style="white-space:nowrap;">閉じる</button>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
